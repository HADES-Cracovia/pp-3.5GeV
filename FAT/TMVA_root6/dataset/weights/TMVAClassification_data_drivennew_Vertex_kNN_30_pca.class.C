// Class: ReadkNN_30_pca
// Automatically generated by MethodBase::MakeClass
//

/* configuration options =====================================================

#GEN -*-*-*-*-*-*-*-*-*-*-*- general info -*-*-*-*-*-*-*-*-*-*-*-

Method         : KNN::kNN_30_pca
TMVA Release   : 4.2.1         [262657]
ROOT Release   : 6.12/06       [396294]
Creator        : knowakow
Date           : Fri Dec 20 17:13:59 2019
Host           : Linux lxbuild05 3.16.0-4-amd64 #1 SMP Debian 3.16.43-2+deb8u5 (2017-09-19) x86_64 GNU/Linux
Dir            : /lustre/hades/user/knowakow/PP/FAT/TMVA_root6
Training events: 88656
Analysis type  : [Classification]


#OPT -*-*-*-*-*-*-*-*-*-*-*-*- options -*-*-*-*-*-*-*-*-*-*-*-*-

# Set by User:
VarTransform: "N,P" [List of variable transformations performed before training, e.g., "D_Background,P_Signal,G,N_AllClasses" for: "Decorrelation, PCA-transformation, Gaussianisation, Normalisation, each for the given class of events ('AllClasses' denotes all events of all classes, if no class indication is given, 'All' is assumed)"]
nkNN: "30" [Number of k-nearest neighbors]
# Default:
V: "False" [Verbose output (short form of "VerbosityLevel" below - overrides the latter one)]
VerbosityLevel: "Default" [Verbosity level]
H: "False" [Print method-specific help message]
CreateMVAPdfs: "False" [Create PDFs for classifier outputs (signal and background)]
IgnoreNegWeightsInTraining: "False" [Events with negative weights are ignored in the training (but are included for testing and performance evaluation)]
BalanceDepth: "6" [Binary tree balance depth]
ScaleFrac: "8.000000e-01" [Fraction of events used to compute variable width]
SigmaFact: "1.000000e+00" [Scale factor for sigma in Gaussian kernel]
Kernel: "Gaus" [Use polynomial (=Poln) or Gaussian (=Gaus) kernel]
Trim: "False" [Use equal number of signal and background events]
UseKernel: "False" [Use polynomial kernel weight]
UseWeight: "True" [Use weight to count kNN events]
UseLDA: "False" [Use local linear discriminant - experimental feature]
##


#VAR -*-*-*-*-*-*-*-*-*-*-*-* variables *-*-*-*-*-*-*-*-*-*-*-*-

NVar 11
dist_p_pim                    dist_p_pim                    dist_p_pim                    dist_p_pim                    mm                                'F'    [8.35415994516e-05,537.973815918]
dist_pip_pim                  dist_pip_pim                  dist_pip_pim                  dist_pip_pim                  mm                                'F'    [9.82056080829e-05,523.380737305]
ver_pip_pim_x                 ver_pip_pim_x                 ver_pip_pim_x                 ver_pip_pim_x                 mm                                'F'    [-10713.7255859,7220.38916016]
ver_pip_pim_y                 ver_pip_pim_y                 ver_pip_pim_y                 ver_pip_pim_y                 mm                                'F'    [-4486.09814453,8220.10449219]
ver_pip_pim_z                 ver_pip_pim_z                 ver_pip_pim_z                 ver_pip_pim_z                 mm                                'F'    [-19879.9003906,23397.8378906]
ver_p_pim_x                   ver_p_pim_x                   ver_p_pim_x                   ver_p_pim_x                   mm                                'F'    [-4408.59033203,4718.31347656]
ver_p_pim_y                   ver_p_pim_y                   ver_p_pim_y                   ver_p_pim_y                   mm                                'F'    [-10921.9150391,3991.03125]
ver_p_pim_z                   ver_p_pim_z                   ver_p_pim_z                   ver_p_pim_z                   mm                                'F'    [-36484.0898438,15671.0107422]
oa_lambda                     oa_lambda                     oa_lambda                     oa_lambda                     deg                               'F'    [0.0355766527355,179.977890015]
dist_lambda_ver_pip_pim       dist_lambda_ver_pip_pim       dist_lambda_ver_pip_pim       dist_lambda_ver_pip_pim       mm                                'F'    [0.0132899032906,6594.40820312]
dist_ver_to_ver               dist_ver_to_ver               dist_ver_to_ver               dist_ver_to_ver               mm                                'F'    [0.205167040229,32529.6816406]
NSpec 0


============================================================================ */

#include <array>
#include <vector>
#include <cmath>
#include <string>
#include <iostream>

#ifndef IClassifierReader__def
#define IClassifierReader__def

class IClassifierReader {

 public:

   // constructor
   IClassifierReader() : fStatusIsClean( true ) {}
   virtual ~IClassifierReader() {}

   // return classifier response
   virtual double GetMvaValue( const std::vector<double>& inputValues ) const = 0;

   // returns classifier status
   bool IsStatusClean() const { return fStatusIsClean; }

 protected:

   bool fStatusIsClean;
};

#endif

class ReadkNN_30_pca : public IClassifierReader {

 public:

   // constructor
   ReadkNN_30_pca( std::vector<std::string>& theInputVars ) 
      : IClassifierReader(),
        fClassName( "ReadkNN_30_pca" ),
        fNvars( 11 ),
        fIsNormalised( false )
   {      
      // the training input variables
      const char* inputVars[] = { "dist_p_pim", "dist_pip_pim", "ver_pip_pim_x", "ver_pip_pim_y", "ver_pip_pim_z", "ver_p_pim_x", "ver_p_pim_y", "ver_p_pim_z", "oa_lambda", "dist_lambda_ver_pip_pim", "dist_ver_to_ver" };

      // sanity checks
      if (theInputVars.size() <= 0) {
         std::cout << "Problem in class \"" << fClassName << "\": empty input vector" << std::endl;
         fStatusIsClean = false;
      }

      if (theInputVars.size() != fNvars) {
         std::cout << "Problem in class \"" << fClassName << "\": mismatch in number of input values: "
                   << theInputVars.size() << " != " << fNvars << std::endl;
         fStatusIsClean = false;
      }

      // validate input variables
      for (size_t ivar = 0; ivar < theInputVars.size(); ivar++) {
         if (theInputVars[ivar] != inputVars[ivar]) {
            std::cout << "Problem in class \"" << fClassName << "\": mismatch in input variable names" << std::endl
                      << " for variable [" << ivar << "]: " << theInputVars[ivar].c_str() << " != " << inputVars[ivar] << std::endl;
            fStatusIsClean = false;
         }
      }

      // initialize min and max vectors (for normalisation)
      fVmin[0] = -0.959575951099396;
      fVmax[0] = 1.04475438594818;
      fVmin[1] = -0.0713587254285812;
      fVmax[1] = 1.95947980880737;
      fVmin[2] = -1.57032287120819;
      fVmax[2] = 1.19718742370605;
      fVmin[3] = -1.9715404510498;
      fVmax[3] = 0.179177179932594;
      fVmin[4] = -2.12995934486389;
      fVmax[4] = 0.566370010375977;
      fVmin[5] = -1.38433265686035;
      fVmax[5] = 1.23498296737671;
      fVmin[6] = -1.00920212268829;
      fVmax[6] = 0.701118290424347;
      fVmin[7] = -0.792168498039246;
      fVmax[7] = 0.979183435440063;
      fVmin[8] = -0.861625552177429;
      fVmax[8] = 1.66441059112549;
      fVmin[9] = -0.40962353348732;
      fVmax[9] = 0.418168783187866;
      fVmin[10] = -0.525563299655914;
      fVmax[10] = 0.254065066576004;

      // initialize input variable types
      fType[0] = 'F';
      fType[1] = 'F';
      fType[2] = 'F';
      fType[3] = 'F';
      fType[4] = 'F';
      fType[5] = 'F';
      fType[6] = 'F';
      fType[7] = 'F';
      fType[8] = 'F';
      fType[9] = 'F';
      fType[10] = 'F';

      // initialize constants
      Initialize();

      // initialize transformation
      InitTransform();
   }

   // destructor
   virtual ~ReadkNN_30_pca() {
      Clear(); // method-specific
   }

   // the classifier response
   // "inputValues" is a vector of input values in the same order as the 
   // variables given to the constructor
   double GetMvaValue( const std::vector<double>& inputValues ) const;

 private:

   // method-specific destructor
   void Clear();

   // input variable transformation

   double fMin_1[3][11];
   double fMax_1[3][11];

   void X2P_2( const double*, double*, int ) const;
   double fMeanValues_2[3][11];
   double fEigenVectors_2[3][11][11];

   void InitTransform_1();
   void Transform_1( std::vector<double> & iv, int sigOrBgd ) const;
   void InitTransform_2();
   void Transform_2( std::vector<double> & iv, int sigOrBgd ) const;
   void InitTransform();
   void Transform( std::vector<double> & iv, int sigOrBgd ) const;

   // common member variables
   const char* fClassName;

   const size_t fNvars;
   size_t GetNvar()           const { return fNvars; }
   char   GetType( int ivar ) const { return fType[ivar]; }

   // normalisation of input variables
   const bool fIsNormalised;
   bool IsNormalised() const { return fIsNormalised; }
   double fVmin[11];
   double fVmax[11];
   double NormVariable( double x, double xmin, double xmax ) const {
      // normalise to output range: [-1, 1]
      return 2*(x - xmin)/(xmax - xmin) - 1.0;
   }

   // type of input variable: 'F' or 'I'
   char   fType[11];

   // initialize internal variables
   void Initialize();
   double GetMvaValue__( const std::vector<double>& inputValues ) const;

   // private members (method specific)
   // not implemented for class: "ReadkNN_30_pca"
};
   inline double ReadkNN_30_pca::GetMvaValue( const std::vector<double>& inputValues ) const
   {
      // classifier response value
      double retval = 0;

      // classifier response, sanity check first
      if (!IsStatusClean()) {
         std::cout << "Problem in class \"" << fClassName << "\": cannot return classifier response"
                   << " because status is dirty" << std::endl;
         retval = 0;
      }
      else {
         if (IsNormalised()) {
            // normalise variables
            std::vector<double> iV;
            iV.reserve(inputValues.size());
            int ivar = 0;
            for (std::vector<double>::const_iterator varIt = inputValues.begin();
                 varIt != inputValues.end(); varIt++, ivar++) {
               iV.push_back(NormVariable( *varIt, fVmin[ivar], fVmax[ivar] ));
            }
            Transform( iV, -1 );
            retval = GetMvaValue__( iV );
         }
         else {
            std::vector<double> iV;
            int ivar = 0;
            for (std::vector<double>::const_iterator varIt = inputValues.begin();
                 varIt != inputValues.end(); varIt++, ivar++) {
               iV.push_back(*varIt);
            }
            Transform( iV, -1 );
            retval = GetMvaValue__( iV );
         }
      }

      return retval;
   }

//_______________________________________________________________________
inline void ReadkNN_30_pca::InitTransform_1()
{
   // Normalization transformation, initialisation
   fMin_1[0][0] = 0.000180718969204;
   fMax_1[0][0] = 537.973815918;
   fMin_1[1][0] = 8.35415994516e-05;
   fMax_1[1][0] = 524.577941895;
   fMin_1[2][0] = 8.35415994516e-05;
   fMax_1[2][0] = 537.973815918;
   fMin_1[0][1] = 9.82056080829e-05;
   fMax_1[0][1] = 479.61706543;
   fMin_1[1][1] = 0.000624384789262;
   fMax_1[1][1] = 523.380737305;
   fMin_1[2][1] = 9.82056080829e-05;
   fMax_1[2][1] = 523.380737305;
   fMin_1[0][2] = -5373.77734375;
   fMax_1[0][2] = 7220.38916016;
   fMin_1[1][2] = -10713.7255859;
   fMax_1[1][2] = 3911.87451172;
   fMin_1[2][2] = -10713.7255859;
   fMax_1[2][2] = 7220.38916016;
   fMin_1[0][3] = -4486.09814453;
   fMax_1[0][3] = 6081.44091797;
   fMin_1[1][3] = -3220.06445312;
   fMax_1[1][3] = 8220.10449219;
   fMin_1[2][3] = -4486.09814453;
   fMax_1[2][3] = 8220.10449219;
   fMin_1[0][4] = -19879.9003906;
   fMax_1[0][4] = 17090.265625;
   fMin_1[1][4] = -12363.8857422;
   fMax_1[1][4] = 23397.8378906;
   fMin_1[2][4] = -19879.9003906;
   fMax_1[2][4] = 23397.8378906;
   fMin_1[0][5] = -1141.33544922;
   fMax_1[0][5] = 4718.31347656;
   fMin_1[1][5] = -4408.59033203;
   fMax_1[1][5] = 1345.7166748;
   fMin_1[2][5] = -4408.59033203;
   fMax_1[2][5] = 4718.31347656;
   fMin_1[0][6] = -1641.42785645;
   fMax_1[0][6] = 2428.35839844;
   fMin_1[1][6] = -10921.9150391;
   fMax_1[1][6] = 3991.03125;
   fMin_1[2][6] = -10921.9150391;
   fMax_1[2][6] = 3991.03125;
   fMin_1[0][7] = -3113.02905273;
   fMax_1[0][7] = 11520.6845703;
   fMin_1[1][7] = -36484.0898438;
   fMax_1[1][7] = 15671.0107422;
   fMin_1[2][7] = -36484.0898438;
   fMax_1[2][7] = 15671.0107422;
   fMin_1[0][8] = 0.0659763514996;
   fMax_1[0][8] = 179.977890015;
   fMin_1[1][8] = 0.0355766527355;
   fMax_1[1][8] = 179.900543213;
   fMin_1[2][8] = 0.0355766527355;
   fMax_1[2][8] = 179.977890015;
   fMin_1[0][9] = 0.0196817759424;
   fMax_1[0][9] = 3434.06689453;
   fMin_1[1][9] = 0.0132899032906;
   fMax_1[1][9] = 6594.40820312;
   fMin_1[2][9] = 0.0132899032906;
   fMax_1[2][9] = 6594.40820312;
   fMin_1[0][10] = 0.205167040229;
   fMax_1[0][10] = 21260.8417969;
   fMin_1[1][10] = 0.279612034559;
   fMax_1[1][10] = 32529.6816406;
   fMin_1[2][10] = 0.205167040229;
   fMax_1[2][10] = 32529.6816406;
}

//_______________________________________________________________________
inline void ReadkNN_30_pca::Transform_1( std::vector<double>& iv, int cls) const
{
   // Normalization transformation
   if (cls < 0 || cls > 2) {
   if (2 > 1 ) cls = 2;
      else cls = 2;
   }
   const int nVar = 11;

   // get indices of used variables

   // define the indices of the variables which are transformed by this transformation
   static std::vector<int> indicesGet;
   static std::vector<int> indicesPut;

   if ( indicesGet.empty() ) { 
      indicesGet.reserve(fNvars);
      indicesGet.push_back( 0);
      indicesGet.push_back( 1);
      indicesGet.push_back( 2);
      indicesGet.push_back( 3);
      indicesGet.push_back( 4);
      indicesGet.push_back( 5);
      indicesGet.push_back( 6);
      indicesGet.push_back( 7);
      indicesGet.push_back( 8);
      indicesGet.push_back( 9);
      indicesGet.push_back( 10);
   } 
   if ( indicesPut.empty() ) { 
      indicesPut.reserve(fNvars);
      indicesPut.push_back( 0);
      indicesPut.push_back( 1);
      indicesPut.push_back( 2);
      indicesPut.push_back( 3);
      indicesPut.push_back( 4);
      indicesPut.push_back( 5);
      indicesPut.push_back( 6);
      indicesPut.push_back( 7);
      indicesPut.push_back( 8);
      indicesPut.push_back( 9);
      indicesPut.push_back( 10);
   } 

   static std::vector<double> dv;
   dv.resize(nVar);
   for (int ivar=0; ivar<nVar; ivar++) dv[ivar] = iv[indicesGet.at(ivar)];
   for (int ivar=0;ivar<11;ivar++) {
      double offset = fMin_1[cls][ivar];
      double scale  = 1.0/(fMax_1[cls][ivar]-fMin_1[cls][ivar]);
      iv[indicesPut.at(ivar)] = (dv[ivar]-offset)*scale * 2 - 1;
   }
}

//_______________________________________________________________________
inline void ReadkNN_30_pca::X2P_2( const double* x, double* p, int index ) const
{
   // Calculate the principal components from the original data vector
   // x, and return it in p (function extracted from TPrincipal::X2P)
   // It's the users responsibility to make sure that both x and p are
   // of the right size (i.e., memory must be allocated for p).
   const int nVar = 11;

   for (int i = 0; i < nVar; i++) {
      p[i] = 0;
      for (int j = 0; j < nVar; j++) p[i] += (x[j] - fMeanValues_2[index][j]) * fEigenVectors_2[index][j][i];
   }
}

//_______________________________________________________________________
inline void ReadkNN_30_pca::InitTransform_2()
{
   // PCA transformation, initialisation
   // initialise vector of mean values
   fMeanValues_2[0][0] = -0.951303834876;
   fMeanValues_2[0][1] = -0.948250778011;
   fMeanValues_2[0][2] = 0.19468880919;
   fMeanValues_2[0][3] = -0.29418715861;
   fMeanValues_2[0][4] = -0.0824326167837;
   fMeanValues_2[0][5] = -0.0339988336274;
   fMeanValues_2[0][6] = 0.464798953414;
   fMeanValues_2[0][7] = 0.398157163868;
   fMeanValues_2[0][8] = -0.0553369616958;
   fMeanValues_2[0][9] = -0.991053260945;
   fMeanValues_2[0][10] = -0.996181415088;
   fMeanValues_2[1][0] = -0.956785058903;
   fMeanValues_2[1][1] = -0.954621910048;
   fMeanValues_2[1][2] = 0.194727562886;
   fMeanValues_2[1][3] = -0.29403854181;
   fMeanValues_2[1][4] = -0.0826784654392;
   fMeanValues_2[1][5] = -0.0334483947019;
   fMeanValues_2[1][6] = 0.464380868078;
   fMeanValues_2[1][7] = 0.397847296642;
   fMeanValues_2[1][8] = -0.0255706341427;
   fMeanValues_2[1][9] = -0.992204092185;
   fMeanValues_2[1][10] = -0.997042981255;
   fMeanValues_2[2][0] = -0.95404444689;
   fMeanValues_2[2][1] = -0.95143634403;
   fMeanValues_2[2][2] = 0.194708186038;
   fMeanValues_2[2][3] = -0.29411285021;
   fMeanValues_2[2][4] = -0.0825555411115;
   fMeanValues_2[2][5] = -0.0337236141646;
   fMeanValues_2[2][6] = 0.464589910746;
   fMeanValues_2[2][7] = 0.398002230255;
   fMeanValues_2[2][8] = -0.0404537979193;
   fMeanValues_2[2][9] = -0.991628676565;
   fMeanValues_2[2][10] = -0.996612198171;

   // initialise matrix of eigenvectors
   fEigenVectors_2[0][0][0] = 0.00185172247748;
   fEigenVectors_2[0][0][1] = 0.592595048826;
   fEigenVectors_2[0][0][2] = -0.803474870508;
   fEigenVectors_2[0][0][3] = -0.0567352735014;
   fEigenVectors_2[0][0][4] = -0.00515005202919;
   fEigenVectors_2[0][0][5] = -0.000819159700612;
   fEigenVectors_2[0][0][6] = -0.00203594245722;
   fEigenVectors_2[0][0][7] = -0.000431232897736;
   fEigenVectors_2[0][0][8] = -0.000181214367726;
   fEigenVectors_2[0][0][9] = 0.00169316867599;
   fEigenVectors_2[0][0][10] = -0.00157977602618;
   fEigenVectors_2[0][1][0] = 0.00544120845011;
   fEigenVectors_2[0][1][1] = 0.799317832902;
   fEigenVectors_2[0][1][2] = 0.595259998141;
   fEigenVectors_2[0][1][3] = -0.0816370446774;
   fEigenVectors_2[0][1][4] = 0.00693346270526;
   fEigenVectors_2[0][1][5] = 0.00351461688723;
   fEigenVectors_2[0][1][6] = 0.000284252508416;
   fEigenVectors_2[0][1][7] = 0.000540672562261;
   fEigenVectors_2[0][1][8] = 0.000662846864277;
   fEigenVectors_2[0][1][9] = 0.000820719780876;
   fEigenVectors_2[0][1][10] = -0.00064132327672;
   fEigenVectors_2[0][2][0] = -0.000585648913879;
   fEigenVectors_2[0][2][1] = -0.000570714456402;
   fEigenVectors_2[0][2][2] = -0.000379210137479;
   fEigenVectors_2[0][2][3] = -0.0107590892641;
   fEigenVectors_2[0][2][4] = 0.117923457801;
   fEigenVectors_2[0][2][5] = -0.515216770407;
   fEigenVectors_2[0][2][6] = 0.179897290125;
   fEigenVectors_2[0][2][7] = 0.264911719656;
   fEigenVectors_2[0][2][8] = 0.77263355245;
   fEigenVectors_2[0][2][9] = 0.000526976082873;
   fEigenVectors_2[0][2][10] = -0.145000099342;
   fEigenVectors_2[0][3][0] = -0.000173484752736;
   fEigenVectors_2[0][3][1] = -0.0050612253114;
   fEigenVectors_2[0][3][2] = -0.000227942175925;
   fEigenVectors_2[0][3][3] = -0.0433007162939;
   fEigenVectors_2[0][3][4] = 0.297023369333;
   fEigenVectors_2[0][3][5] = -0.326678317425;
   fEigenVectors_2[0][3][6] = -0.863405769417;
   fEigenVectors_2[0][3][7] = 0.195012430753;
   fEigenVectors_2[0][3][8] = -0.130720147847;
   fEigenVectors_2[0][3][9] = -0.0503338364559;
   fEigenVectors_2[0][3][10] = -0.00609277856384;
   fEigenVectors_2[0][4][0] = 0.00256115995202;
   fEigenVectors_2[0][4][1] = 0.00514703718444;
   fEigenVectors_2[0][4][2] = -0.00011635004489;
   fEigenVectors_2[0][4][3] = 0.0731726567102;
   fEigenVectors_2[0][4][4] = -0.167221347063;
   fEigenVectors_2[0][4][5] = 0.72008463858;
   fEigenVectors_2[0][4][6] = -0.313217653835;
   fEigenVectors_2[0][4][7] = 0.385096368462;
   fEigenVectors_2[0][4][8] = 0.420781818605;
   fEigenVectors_2[0][4][9] = 0.0655207583066;
   fEigenVectors_2[0][4][10] = -0.14273405793;
   fEigenVectors_2[0][5][0] = 0.000198508278307;
   fEigenVectors_2[0][5][1] = -0.00037487454663;
   fEigenVectors_2[0][5][2] = 0.000460392385299;
   fEigenVectors_2[0][5][3] = 0.00464457283972;
   fEigenVectors_2[0][5][4] = 0.035811724892;
   fEigenVectors_2[0][5][5] = 0.0862676668731;
   fEigenVectors_2[0][5][6] = -0.283226602242;
   fEigenVectors_2[0][5][7] = -0.847818513566;
   fEigenVectors_2[0][5][8] = 0.410668841291;
   fEigenVectors_2[0][5][9] = 0.153218825009;
   fEigenVectors_2[0][5][10] = 0.0107238216654;
   fEigenVectors_2[0][6][0] = -0.000117475998664;
   fEigenVectors_2[0][6][1] = 0.00108594390853;
   fEigenVectors_2[0][6][2] = -0.000409804327568;
   fEigenVectors_2[0][6][3] = 0.00680251568662;
   fEigenVectors_2[0][6][4] = 0.018569177455;
   fEigenVectors_2[0][6][5] = 0.0597490009571;
   fEigenVectors_2[0][6][6] = 0.00199674852199;
   fEigenVectors_2[0][6][7] = -0.154792680905;
   fEigenVectors_2[0][6][8] = -0.0135840795718;
   fEigenVectors_2[0][6][9] = -0.815879097714;
   fEigenVectors_2[0][6][10] = -0.553380173957;
   fEigenVectors_2[0][7][0] = -0.00143300011552;
   fEigenVectors_2[0][7][1] = 0.0037544996106;
   fEigenVectors_2[0][7][2] = -0.00195746670006;
   fEigenVectors_2[0][7][3] = 0.0211177384281;
   fEigenVectors_2[0][7][4] = 0.0593628255972;
   fEigenVectors_2[0][7][5] = 0.0883919365803;
   fEigenVectors_2[0][7][6] = -0.012634709147;
   fEigenVectors_2[0][7][7] = 0.0227062726535;
   fEigenVectors_2[0][7][8] = 0.197018922317;
   fEigenVectors_2[0][7][9] = -0.546474957388;
   fEigenVectors_2[0][7][10] = 0.806269455381;
   fEigenVectors_2[0][8][0] = 0.999972624131;
   fEigenVectors_2[0][8][1] = -0.00579177102325;
   fEigenVectors_2[0][8][2] = -0.00177473059958;
   fEigenVectors_2[0][8][3] = -0.00295052587332;
   fEigenVectors_2[0][8][4] = 0.00161410728012;
   fEigenVectors_2[0][8][5] = -0.00150619605688;
   fEigenVectors_2[0][8][6] = 0.00108240483558;
   fEigenVectors_2[0][8][7] = -0.000565506736121;
   fEigenVectors_2[0][8][8] = -0.000345648485226;
   fEigenVectors_2[0][8][9] = -0.00103958946595;
   fEigenVectors_2[0][8][10] = 0.00133623351234;
   fEigenVectors_2[0][9][0] = 0.0035555649015;
   fEigenVectors_2[0][9][1] = 0.0927528588611;
   fEigenVectors_2[0][9][2] = 0.00616802570642;
   fEigenVectors_2[0][9][3] = 0.916627029483;
   fEigenVectors_2[0][9][4] = -0.330060135083;
   fEigenVectors_2[0][9][5] = -0.180538644833;
   fEigenVectors_2[0][9][6] = -0.0896736827266;
   fEigenVectors_2[0][9][7] = -0.014570256743;
   fEigenVectors_2[0][9][8] = -0.0288459788786;
   fEigenVectors_2[0][9][9] = -0.0187685799182;
   fEigenVectors_2[0][9][10] = 0.0130077867966;
   fEigenVectors_2[0][10][0] = 0.000184403447248;
   fEigenVectors_2[0][10][1] = 0.0348944536066;
   fEigenVectors_2[0][10][2] = -0.00693195453958;
   fEigenVectors_2[0][10][3] = 0.376887160857;
   fEigenVectors_2[0][10][4] = 0.869333114605;
   fEigenVectors_2[0][10][5] = 0.240575117837;
   fEigenVectors_2[0][10][6] = 0.18877088159;
   fEigenVectors_2[0][10][7] = 0.00265487199873;
   fEigenVectors_2[0][10][8] = -0.0202419207414;
   fEigenVectors_2[0][10][9] = 0.0710407433812;
   fEigenVectors_2[0][10][10] = -0.0444509950626;
   fEigenVectors_2[1][0][0] = -0.000406749547559;
   fEigenVectors_2[1][0][1] = 0.600248416282;
   fEigenVectors_2[1][0][2] = -0.797617413548;
   fEigenVectors_2[1][0][3] = 0.0585152733394;
   fEigenVectors_2[1][0][4] = -0.00277940387161;
   fEigenVectors_2[1][0][5] = 0.00020980004563;
   fEigenVectors_2[1][0][6] = 0.00724016958227;
   fEigenVectors_2[1][0][7] = 0.00480179260128;
   fEigenVectors_2[1][0][8] = 0.000152767741426;
   fEigenVectors_2[1][0][9] = 0.000564249169407;
   fEigenVectors_2[1][0][10] = -0.000713871220438;
   fEigenVectors_2[1][1][0] = 0.00502040423382;
   fEigenVectors_2[1][1][1] = 0.792662436712;
   fEigenVectors_2[1][1][2] = 0.602987565648;
   fEigenVectors_2[1][1][3] = 0.0870447583677;
   fEigenVectors_2[1][1][4] = -0.0209833349737;
   fEigenVectors_2[1][1][5] = -0.00637604894534;
   fEigenVectors_2[1][1][6] = 0.000691533495286;
   fEigenVectors_2[1][1][7] = 0.00126599167348;
   fEigenVectors_2[1][1][8] = -0.00209719314687;
   fEigenVectors_2[1][1][9] = 0.00121522804687;
   fEigenVectors_2[1][1][10] = 0.00116291980794;
   fEigenVectors_2[1][2][0] = -0.000359044509865;
   fEigenVectors_2[1][2][1] = -0.000827059177486;
   fEigenVectors_2[1][2][2] = -0.00127038249921;
   fEigenVectors_2[1][2][3] = 0.0760454564619;
   fEigenVectors_2[1][2][4] = 0.210495001276;
   fEigenVectors_2[1][2][5] = -0.307599148861;
   fEigenVectors_2[1][2][6] = -0.271746709075;
   fEigenVectors_2[1][2][7] = -0.5016668217;
   fEigenVectors_2[1][2][8] = 0.475521491975;
   fEigenVectors_2[1][2][9] = -0.44133556091;
   fEigenVectors_2[1][2][10] = -0.329963087717;
   fEigenVectors_2[1][3][0] = 0.000117058163198;
   fEigenVectors_2[1][3][1] = -0.00280602281972;
   fEigenVectors_2[1][3][2] = -0.000623059167852;
   fEigenVectors_2[1][3][3] = -0.0259025269734;
   fEigenVectors_2[1][3][4] = -0.367520812561;
   fEigenVectors_2[1][3][5] = 0.322656643248;
   fEigenVectors_2[1][3][6] = 0.517662076093;
   fEigenVectors_2[1][3][7] = -0.472210054467;
   fEigenVectors_2[1][3][8] = 0.454206286361;
   fEigenVectors_2[1][3][9] = 0.232452839347;
   fEigenVectors_2[1][3][10] = 0.0940632376378;
   fEigenVectors_2[1][4][0] = 0.00204958349887;
   fEigenVectors_2[1][4][1] = 0.00633133032722;
   fEigenVectors_2[1][4][2] = 0.00136205087543;
   fEigenVectors_2[1][4][3] = -0.0464204674511;
   fEigenVectors_2[1][4][4] = -0.189270959071;
   fEigenVectors_2[1][4][5] = 0.758393646484;
   fEigenVectors_2[1][4][6] = -0.258277207937;
   fEigenVectors_2[1][4][7] = 0.246030038683;
   fEigenVectors_2[1][4][8] = 0.119952012949;
   fEigenVectors_2[1][4][9] = -0.396342476094;
   fEigenVectors_2[1][4][10] = -0.296817856045;
   fEigenVectors_2[1][5][0] = 9.86234503228e-05;
   fEigenVectors_2[1][5][1] = -0.00287823056073;
   fEigenVectors_2[1][5][2] = 0.00187604703515;
   fEigenVectors_2[1][5][3] = 0.0300831118171;
   fEigenVectors_2[1][5][4] = 0.0707974686729;
   fEigenVectors_2[1][5][5] = 0.064773310428;
   fEigenVectors_2[1][5][6] = 0.47832805607;
   fEigenVectors_2[1][5][7] = -0.266590257571;
   fEigenVectors_2[1][5][8] = -0.5073466663;
   fEigenVectors_2[1][5][9] = -0.644060295607;
   fEigenVectors_2[1][5][10] = 0.133390144838;
   fEigenVectors_2[1][6][0] = -0.000115024098813;
   fEigenVectors_2[1][6][1] = 0.000200698711869;
   fEigenVectors_2[1][6][2] = 0.000207042364337;
   fEigenVectors_2[1][6][3] = 0.0645489590097;
   fEigenVectors_2[1][6][4] = 0.207146656675;
   fEigenVectors_2[1][6][5] = 0.279447643709;
   fEigenVectors_2[1][6][6] = -0.175074772374;
   fEigenVectors_2[1][6][7] = -0.504646323746;
   fEigenVectors_2[1][6][8] = -0.473624249008;
   fEigenVectors_2[1][6][9] = 0.414824824156;
   fEigenVectors_2[1][6][10] = -0.439447335401;
   fEigenVectors_2[1][7][0] = -0.00129088811468;
   fEigenVectors_2[1][7][1] = 0.00316302931867;
   fEigenVectors_2[1][7][2] = -0.00224331201723;
   fEigenVectors_2[1][7][3] = 0.0372674181819;
   fEigenVectors_2[1][7][4] = 0.136076004136;
   fEigenVectors_2[1][7][5] = 0.260296404865;
   fEigenVectors_2[1][7][6] = -0.479566849333;
   fEigenVectors_2[1][7][7] = -0.31538641787;
   fEigenVectors_2[1][7][8] = 0.00110031189998;
   fEigenVectors_2[1][7][9] = -0.0255988067257;
   fEigenVectors_2[1][7][10] = 0.763029536461;
   fEigenVectors_2[1][8][0] = 0.999980740898;
   fEigenVectors_2[1][8][1] = -0.00402289846706;
   fEigenVectors_2[1][8][2] = -0.00338304424868;
   fEigenVectors_2[1][8][3] = 0.0022602942849;
   fEigenVectors_2[1][8][4] = -5.05033052167e-05;
   fEigenVectors_2[1][8][5] = -0.00144380818742;
   fEigenVectors_2[1][8][6] = -0.000491924310669;
   fEigenVectors_2[1][8][7] = -0.000994107849205;
   fEigenVectors_2[1][8][8] = -0.00027703196225;
   fEigenVectors_2[1][8][9] = 0.000668813487561;
   fEigenVectors_2[1][8][10] = 0.00139239767813;
   fEigenVectors_2[1][9][0] = 0.00264134001432;
   fEigenVectors_2[1][9][1] = 0.100862097934;
   fEigenVectors_2[1][9][2] = 0.0107051115332;
   fEigenVectors_2[1][9][3] = -0.882519168438;
   fEigenVectors_2[1][9][4] = 0.426385607283;
   fEigenVectors_2[1][9][5] = 0.0879469575083;
   fEigenVectors_2[1][9][6] = 0.109002647108;
   fEigenVectors_2[1][9][7] = -0.00161312670376;
   fEigenVectors_2[1][9][8] = 0.0944146885061;
   fEigenVectors_2[1][9][9] = 0.0223860112508;
   fEigenVectors_2[1][9][10] = 0.00513603519303;
   fEigenVectors_2[1][10][0] = 0.000372148531687;
   fEigenVectors_2[1][10][1] = 0.0336419512525;
   fEigenVectors_2[1][10][2] = -0.00860004377477;
   fEigenVectors_2[1][10][3] = -0.441684103067;
   fEigenVectors_2[1][10][4] = -0.732192187134;
   fEigenVectors_2[1][10][5] = -0.26133559942;
   fEigenVectors_2[1][10][6] = -0.300174281838;
   fEigenVectors_2[1][10][7] = -0.198952667932;
   fEigenVectors_2[1][10][8] = -0.250094108766;
   fEigenVectors_2[1][10][9] = -0.0777770391112;
   fEigenVectors_2[1][10][10] = -0.0320075606058;
   fEigenVectors_2[2][0][0] = 0.000675512331424;
   fEigenVectors_2[2][0][1] = 0.597089280158;
   fEigenVectors_2[2][0][2] = -0.800059184438;
   fEigenVectors_2[2][0][3] = 0.0578293795417;
   fEigenVectors_2[2][0][4] = 0.00291879328479;
   fEigenVectors_2[2][0][5] = 0.00154316248272;
   fEigenVectors_2[2][0][6] = 0.00328593668463;
   fEigenVectors_2[2][0][7] = -0.002492828892;
   fEigenVectors_2[2][0][8] = 0.00395565244809;
   fEigenVectors_2[2][0][9] = -0.000300598200606;
   fEigenVectors_2[2][0][10] = 0.00116173858514;
   fEigenVectors_2[2][1][0] = 0.00510841978499;
   fEigenVectors_2[2][1][1] = 0.795516103528;
   fEigenVectors_2[2][1][2] = 0.599802321353;
   fEigenVectors_2[2][1][3] = 0.0849492066759;
   fEigenVectors_2[2][1][4] = -0.0118181973499;
   fEigenVectors_2[2][1][5] = -0.00146688556754;
   fEigenVectors_2[2][1][6] = -0.00159193240121;
   fEigenVectors_2[2][1][7] = -0.00167932331974;
   fEigenVectors_2[2][1][8] = 0.00128793162868;
   fEigenVectors_2[2][1][9] = 4.97855462885e-05;
   fEigenVectors_2[2][1][10] = -5.91202148861e-05;
   fEigenVectors_2[2][2][0] = -0.000477917161542;
   fEigenVectors_2[2][2][1] = -0.000706024976483;
   fEigenVectors_2[2][2][2] = -0.000803148959985;
   fEigenVectors_2[2][2][3] = 0.0361858767728;
   fEigenVectors_2[2][2][4] = 0.127466748842;
   fEigenVectors_2[2][2][5] = -0.505214997366;
   fEigenVectors_2[2][2][6] = -0.00120218891005;
   fEigenVectors_2[2][2][7] = 0.51125452467;
   fEigenVectors_2[2][2][8] = -0.281222146863;
   fEigenVectors_2[2][2][9] = -0.558744098544;
   fEigenVectors_2[2][2][10] = 0.27301235682;
   fEigenVectors_2[2][3][0] = -3.36797678298e-05;
   fEigenVectors_2[2][3][1] = -0.00400276535554;
   fEigenVectors_2[2][3][2] = -0.000419377324093;
   fEigenVectors_2[2][3][3] = 0.0167360416282;
   fEigenVectors_2[2][3][4] = -0.333717246113;
   fEigenVectors_2[2][3][5] = 0.0201861131265;
   fEigenVectors_2[2][3][6] = 0.888642716701;
   fEigenVectors_2[2][3][7] = 0.271240808472;
   fEigenVectors_2[2][3][8] = -0.0308373411286;
   fEigenVectors_2[2][3][9] = 0.148442906087;
   fEigenVectors_2[2][3][10] = -0.0410528214654;
   fEigenVectors_2[2][4][0] = 0.00231401349937;
   fEigenVectors_2[2][4][1] = 0.00579402467384;
   fEigenVectors_2[2][4][2] = 0.000583843286981;
   fEigenVectors_2[2][4][3] = -0.0553364387205;
   fEigenVectors_2[2][4][4] = -0.117373243699;
   fEigenVectors_2[2][4][5] = 0.829431044422;
   fEigenVectors_2[2][4][6] = -0.0807000377699;
   fEigenVectors_2[2][4][7] = 0.302168326734;
   fEigenVectors_2[2][4][8] = -0.0229580564935;
   fEigenVectors_2[2][4][9] = -0.38137870832;
   fEigenVectors_2[2][4][10] = 0.226652357619;
   fEigenVectors_2[2][5][0] = 0.000162480222045;
   fEigenVectors_2[2][5][1] = -0.00170015181808;
   fEigenVectors_2[2][5][2] = 0.00114359095901;
   fEigenVectors_2[2][5][3] = 0.0114677053107;
   fEigenVectors_2[2][5][4] = 0.0306906497426;
   fEigenVectors_2[2][5][5] = 0.0607833827269;
   fEigenVectors_2[2][5][6] = 0.287506673528;
   fEigenVectors_2[2][5][7] = -0.691917962361;
   fEigenVectors_2[2][5][8] = -0.419128481148;
   fEigenVectors_2[2][5][9] = -0.503448219595;
   fEigenVectors_2[2][5][10] = -0.0684717747568;
   fEigenVectors_2[2][6][0] = -0.000124683357321;
   fEigenVectors_2[2][6][1] = 0.000751025587274;
   fEigenVectors_2[2][6][2] = -0.00012665940343;
   fEigenVectors_2[2][6][3] = 0.020892343139;
   fEigenVectors_2[2][6][4] = 0.117220340164;
   fEigenVectors_2[2][6][5] = 0.0964182842397;
   fEigenVectors_2[2][6][6] = -0.0364843953436;
   fEigenVectors_2[2][6][7] = -0.0211876859972;
   fEigenVectors_2[2][6][8] = -0.665559700682;
   fEigenVectors_2[2][6][9] = 0.51085752348;
   fEigenVectors_2[2][6][10] = 0.520385114197;
   fEigenVectors_2[2][7][0] = -0.00137156321432;
   fEigenVectors_2[2][7][1] = 0.00352090275147;
   fEigenVectors_2[2][7][2] = -0.00209286017368;
   fEigenVectors_2[2][7][3] = 0.00168038742601;
   fEigenVectors_2[2][7][4] = 0.0515199487762;
   fEigenVectors_2[2][7][5] = 0.113555651559;
   fEigenVectors_2[2][7][6] = -0.139774446534;
   fEigenVectors_2[2][7][7] = 0.298059145706;
   fEigenVectors_2[2][7][8] = -0.525633445984;
   fEigenVectors_2[2][7][9] = 0.0699070226281;
   fEigenVectors_2[2][7][10] = -0.771281832781;
   fEigenVectors_2[2][8][0] = 0.999978132518;
   fEigenVectors_2[2][8][1] = -0.00478473235617;
   fEigenVectors_2[2][8][2] = -0.00255246512428;
   fEigenVectors_2[2][8][3] = 0.00260093994053;
   fEigenVectors_2[2][8][4] = -0.000471485825462;
   fEigenVectors_2[2][8][5] = -0.0019765738482;
   fEigenVectors_2[2][8][6] = -0.000398383975427;
   fEigenVectors_2[2][8][7] = 1.38197476849e-05;
   fEigenVectors_2[2][8][8] = -0.000894601525355;
   fEigenVectors_2[2][8][9] = 0.000806782385046;
   fEigenVectors_2[2][8][10] = -0.00134966757064;
   fEigenVectors_2[2][9][0] = 0.00309997285989;
   fEigenVectors_2[2][9][1] = 0.0967742805598;
   fEigenVectors_2[2][9][2] = 0.00837268429618;
   fEigenVectors_2[2][9][3] = -0.911274369617;
   fEigenVectors_2[2][9][4] = 0.369533821746;
   fEigenVectors_2[2][9][5] = 0.0081569538973;
   fEigenVectors_2[2][9][6] = 0.144910457028;
   fEigenVectors_2[2][9][7] = 0.0281109982075;
   fEigenVectors_2[2][9][8] = 0.0342390470188;
   fEigenVectors_2[2][9][9] = 0.0197806611367;
   fEigenVectors_2[2][9][10] = -0.0126258957433;
   fEigenVectors_2[2][10][0] = 0.000255061229213;
   fEigenVectors_2[2][10][1] = 0.0344154452395;
   fEigenVectors_2[2][10][2] = -0.00768075976194;
   fEigenVectors_2[2][10][3] = -0.392159657985;
   fEigenVectors_2[2][10][4] = -0.839385527122;
   fEigenVectors_2[2][10][5] = -0.174452007228;
   fEigenVectors_2[2][10][6] = -0.281530736288;
   fEigenVectors_2[2][10][7] = -0.0700259622858;
   fEigenVectors_2[2][10][8] = -0.152698242046;
   fEigenVectors_2[2][10][9] = -0.0246066576896;
   fEigenVectors_2[2][10][10] = 0.0433626923515;
}

//_______________________________________________________________________
inline void ReadkNN_30_pca::Transform_2( std::vector<double>& iv, int cls ) const
{
   // PCA transformation
   const int nVar = 11;
   double *dv = new double[nVar];
   double *rv = new double[nVar];
   if (cls < 0 || cls > 2) {
       if (2 > 1 ) cls = 2;
       else cls = 2;
   }

   // define the indices of the variables which are transformed by this transformation
   static std::vector<int> indicesGet;
   static std::vector<int> indicesPut;

   if ( indicesGet.empty() ) { 
      indicesGet.reserve(fNvars);
      indicesGet.push_back( 0);
      indicesGet.push_back( 1);
      indicesGet.push_back( 2);
      indicesGet.push_back( 3);
      indicesGet.push_back( 4);
      indicesGet.push_back( 5);
      indicesGet.push_back( 6);
      indicesGet.push_back( 7);
      indicesGet.push_back( 8);
      indicesGet.push_back( 9);
      indicesGet.push_back( 10);
   } 
   if ( indicesPut.empty() ) { 
      indicesPut.reserve(fNvars);
      indicesPut.push_back( 0);
      indicesPut.push_back( 1);
      indicesPut.push_back( 2);
      indicesPut.push_back( 3);
      indicesPut.push_back( 4);
      indicesPut.push_back( 5);
      indicesPut.push_back( 6);
      indicesPut.push_back( 7);
      indicesPut.push_back( 8);
      indicesPut.push_back( 9);
      indicesPut.push_back( 10);
   } 

   for (int ivar=0; ivar<nVar; ivar++) dv[ivar] = iv[indicesGet.at(ivar)];

   // Perform PCA and put it into PCAed events tree
   this->X2P_2( dv, rv, cls );
   for (int ivar=0; ivar<nVar; ivar++) iv[indicesPut.at(ivar)] = rv[ivar];

   delete [] dv;
   delete [] rv;
}

//_______________________________________________________________________
inline void ReadkNN_30_pca::InitTransform()
{
   InitTransform_1();
   InitTransform_2();
}

//_______________________________________________________________________
inline void ReadkNN_30_pca::Transform( std::vector<double>& iv, int sigOrBgd ) const
{
   Transform_1( iv, sigOrBgd );
   Transform_2( iv, sigOrBgd );
}
